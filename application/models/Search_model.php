<?php/*  * Niraj Kumar * Dated: 10-oct-2017 *  * model for global_Search records  */class Search_model extends CI_Model {      public function search_doctormaster_info($data=''){        $desig_id=logged_user_desig();       $log_userid = logged_user_data();                $cities_are = logged_user_cities();         $city_id=explode(',', $cities_are);                   $boss_are = logged_user_boss();          $boss_id=explode(',', $boss_are);                   $doc_are = logged_user_doc();          $doc_id=explode(',', $doc_are);                         $arr = "doc.doctor_id as id,doc.d_id as dealers_id,doc.doc_name as d_name,doc.doc_email as d_email,doc.doc_phone as d_ph,c.city_name as c_city";        $this->db->select($arr);        $this->db->from("doctor_list doc");//        $this->db->join("srm_school_master sm" , "cl.s_id=sm.id");//        $this->db->join("dealer d" , "d.dealer_id=doc.d_id");        $this->db->join("city c" , "c.city_id=doc.city_id");        $this->db->join("state st" , "st.state_id=doc.state_id");                       if(!is_admin()){                         $where_b ='( '; //         $this->db->or_where('pharma.crm_user_id', logged_user_data());          $where_b .=" doc.crm_user_id = ".logged_user_data() ;         if(!empty($boss_are)){            $where_b .= " AND ( ";             $k=0;                foreach($boss_id as $value){//          $this->db->or_where('pharma.city_id',$value);                                 if($k > 0 && count($boss_id)!=$k){                   $where_b .= " OR ";               }                                                $where_b  .= " doc.crm_user_id  != $value ";                                                              $k++;            }                          $where_b .=' ) ';           }         $where_b .='  ) ';             $this->db->where($where_b);                                 //         $where_b ='( '; ////         $this->db->or_where('pharma.crm_user_id', logged_user_data());//          $where_b .=" doc.crm_user_id = ".logged_user_data();//         if(!empty($boss_are)){//             $k=0;    //            foreach($boss_id as $value){////          $this->db->or_where('pharma.city_id',$value);//                $where_b  .= " OR doc.crm_user_id  != $value ";//               //                $k++;//            }//            //           //           }//         $where_b .=' ) ';//             $this->db->where($where_b);                 if(!empty($cities_are)){             $where='( ';                 $k=0;                foreach($city_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " doc.city_id = $value ";                 $k++;               if($k > 0 && count($city_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->or_where($where);        }                          if(!empty($doc_are)){             $where='( ';                 $k=0;                foreach($doc_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " doc.doctor_id = '$value'";                 $k++;                               if($k > 0 && count($doc_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->or_where($where);        }                }                         if(!empty($data)){         $this->db->like('doc.doc_name',$data);//         $this->db->or_like('cl.c_email',$data);//         $this->db->or_like('s.s_phone',$data);         $this->db->or_like('c.city_name',$data);         $this->db->or_like('st.state_name',$data);//     }        }                $query = $this->db->get();//         echo $this->db->last_query(); die;         if($this->db->affected_rows()){                        return json_encode($query->result_array());        }        else{                        return FALSE;        }    }							  public function search_doctor_info($data=''){        $desig_id=logged_user_desig();       $log_userid = logged_user_data();                $cities_are = logged_user_cities();         $city_id=explode(',', $cities_are);                   $boss_are = logged_user_boss();          $boss_id=explode(',', $boss_are);                   $doc_are = logged_user_doc();          $doc_id=explode(',', $doc_are);                         $arr = "doc.doctor_id as id,doc.d_id as dealers_id,doc.doc_name as d_name,doc.doc_email as d_email,doc.doc_phone as d_ph,c.city_name as c_city";        $this->db->select($arr);        $this->db->from("doctor_list doc");//        $this->db->join("srm_school_master sm" , "cl.s_id=sm.id");//        $this->db->join("dealer d" , "d.dealer_id=doc.d_id");        $this->db->join("city c" , "c.city_id=doc.city_id");        $this->db->join("state st" , "st.state_id=doc.state_id");                       if(!is_admin()){                         $where_b ='( '; //         $this->db->or_where('pharma.crm_user_id', logged_user_data());          $where_b .=" doc.crm_user_id = ".logged_user_data(). " AND ( " ;         if(!empty($boss_are)){             $k=0;                foreach($boss_id as $value){//          $this->db->or_where('pharma.city_id',$value);                                 if($k > 0 && count($boss_id)!=$k){                   $where_b .= " OR ";               }                $where_b  .= " doc.crm_user_id  != $value ";                $k++;            }                                  }         $where_b .=' ) ) ';        // $this->db->where($where_b);         if(!empty($cities_are)){             $where='( ';                 $k=0;                foreach($city_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " doc.city_id = $value ";                 $k++;               if($k > 0 && count($city_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->or_where($where);        }                          if(!empty($doc_are)){             $where='( ';                 $k=0;                foreach($doc_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " doc.doctor_id = '$value'";                 $k++;                               if($k > 0 && count($doc_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->or_where($where);        }                }                         if(!empty($data)){		$this->db->where('c.city_name like "'.$data.'" or doc.doc_name like "'.$data.'"');         //$this->db->like('doc.doc_name',$data);//         $this->db->or_like('cl.c_email',$data);//         $this->db->or_like('s.s_phone',$data);                // $this->db->or_like('st.state_name',$data);//     }        }                $query = $this->db->get();   //echo $this->db->last_query(); die;         if($this->db->affected_rows()){                        return json_encode($query->result_array());        }        else{                        return FALSE;        }    }		   public function search_doctormaster_info_doc($data=''){        $desig_id=logged_user_desig();       $log_userid = logged_user_data();                $cities_are = logged_user_cities();         $city_id=explode(',', $cities_are);                   $boss_are = logged_user_boss();          $boss_id=explode(',', $boss_are);                   $doc_are = logged_user_doc();          $doc_id=explode(',', $doc_are);                         $arr = "doc.doctor_id as id,doc.d_id as dealers_id,doc.doc_name as d_name,doc.doc_email as d_email,doc.doc_phone as d_ph,c.city_name as c_city";        $this->db->select($arr);        $this->db->from("doctor_list doc");//        $this->db->join("srm_school_master sm" , "cl.s_id=sm.id");//        $this->db->join("dealer d" , "d.dealer_id=doc.d_id");        $this->db->join("city c" , "c.city_id=doc.city_id");        $this->db->join("state st" , "st.state_id=doc.state_id");                       if(!is_admin()){                         $where_b ='( '; //         $this->db->or_where('pharma.crm_user_id', logged_user_data());          $where_b .=" doc.crm_user_id = ".logged_user_data(). " AND ( " ;         if(!empty($boss_are)){             $k=0;                foreach($boss_id as $value){//          $this->db->or_where('pharma.city_id',$value);                                 if($k > 0 && count($boss_id)!=$k){                   $where_b .= " OR ";               }                                                $where_b  .= " doc.crm_user_id  != $value ";                                                              $k++;            }                                  }         $where_b .=' ) ) ';             $this->db->where($where_b);                                 //         $where_b ='( '; ////         $this->db->or_where('pharma.crm_user_id', logged_user_data());//          $where_b .=" doc.crm_user_id = ".logged_user_data();//         if(!empty($boss_are)){//             $k=0;    //            foreach($boss_id as $value){////          $this->db->or_where('pharma.city_id',$value);//                $where_b  .= " OR doc.crm_user_id  != $value ";//               //                $k++;//            }//            //           //           }//         $where_b .=' ) ';//             $this->db->where($where_b);                 if(!empty($cities_are)){             $where='( ';                 $k=0;                foreach($city_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " doc.city_id = $value ";                 $k++;               if($k > 0 && count($city_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->or_where($where);        }                          if(!empty($doc_are)){             $where='( ';                 $k=0;                foreach($doc_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " doc.doctor_id = '$value'";                 $k++;                               if($k > 0 && count($doc_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->or_where($where);        }                }                         if(!empty($data)){         $this->db->like('doc.doc_name',$data);//         $this->db->or_like('cl.c_email',$data);//         $this->db->or_like('s.s_phone',$data);         //$this->db->or_like('c.city_name',$data);         //$this->db->or_like('st.state_name',$data);//     }        }                $query = $this->db->get();//         echo $this->db->last_query(); die;         if($this->db->affected_rows()){                        return json_encode($query->result_array());        }        else{                        return FALSE;        }    }        public function search_dealermaster_info($data=''){         $cities_are = logged_user_cities();         $city_id=explode(',', $cities_are);                $arr = "d.dealer_id as id,d.d_email as d_email,d.d_phone as d_ph,d.dealer_name as d_name,c.city_name as d_city,d.dealer_are,d.gd_id";        $this->db->select($arr);        $this->db->from("dealer d");//      $this->db->join("dealer s" , "s.dealer_id=sm.s_id");        $this->db->join("city c" , "c.city_id=d.city_id");        $this->db->join("state st" , "st.state_id=d.state_id");                      if(!is_admin()){                 if(!empty($cities_are)){                             $k=0;                 $where=' ( ';            foreach($city_id as $value){//          $this->db->or_where('d.city_id',$value);              $where  .= " d.city_id = $value ";                 $k++;               if($k > 0 && count($city_id)!=$k){                   $where .= " OR ";               }            }            $where  .= " ) ";             $this->db->where($where);           }                   }                 if(!empty($data)){         $this->db->like('d.dealer_name',$data);         $this->db->or_like('d.d_email',$data);         $this->db->or_like('d.d_phone',$data);         $this->db->or_like('c.city_name',$data);         $this->db->or_like('st.state_name',$data);                 $this->db->group_by('`d`.`dealer_id`');//     }        }                               $this->db->where('d.gd_id IS NULL',null,true);                        $this->db->order_by("d.dealer_name","ASC");                $query = $this->db->get();//         echo $this->db->last_query(); die;                 if($this->db->affected_rows()){                        return json_encode($query->result_array());        }        else{                        return FALSE;        }            }		  public function search_dealer_info($data=''){         $cities_are = logged_user_cities();         $city_id=explode(',', $cities_are);                $arr = "d.dealer_id as id,d.d_email as d_email,d.d_phone as d_ph,d.dealer_name as d_name,c.city_name as d_city,d.dealer_are,d.gd_id";        $this->db->select($arr);        $this->db->from("dealer d");//      $this->db->join("dealer s" , "s.dealer_id=sm.s_id");        $this->db->join("city c" , "c.city_id=d.city_id");        $this->db->join("state st" , "st.state_id=d.state_id");                      if(!is_admin()){                 if(!empty($cities_are)){                             $k=0;                 $where=' ( ';            foreach($city_id as $value){//          $this->db->or_where('d.city_id',$value);              $where  .= " d.city_id = $value ";                 $k++;               if($k > 0 && count($city_id)!=$k){                   $where .= " OR ";               }            }            $where  .= " ) ";             $this->db->where($where);           }                   }                 if(!empty($data)){		$this->db->where('c.city_name like "'.$data.'" or d.dealer_name like "'.$data.'"');         $this->db->like('d.dealer_name',$data);         $this->db->or_like('d.d_email',$data);         $this->db->or_like('d.d_phone',$data);         $this->db->or_like('c.city_name',$data);         $this->db->or_like('st.state_name',$data);                 $this->db->group_by('`d`.`dealer_id`');//     }        }                               $this->db->where('d.gd_id IS NULL',null,true);                        $this->db->order_by("d.dealer_name","ASC");                $query = $this->db->get();//         echo $this->db->last_query(); die;                 if($this->db->affected_rows()){                        return json_encode($query->result_array());        }        else{                        return FALSE;        }            }        public function search_pharmacymaster_info($data=''){         $cities_are = logged_user_cities();         $city_id=explode(',', $cities_are);         $boss_are = logged_user_boss();          $boss_id=explode(',', $boss_are);          $pharma_are = logged_user_pharmaare();          $pharma_id=explode(',', $pharma_are);//         echo $pharma_are; die;                 $arr = "pharma.pharma_id as id,pharma.d_id as dealers_id,pharma.company_name as com_name,pharma.company_email as com_email,pharma.company_phone as com_ph,c.city_name as c_city,pharma.pharmacy_status as status,pharma.blocked";        $this->db->select($arr);        $this->db->from("pharmacy_list pharma");//        $this->db->join("srm_school_master sm" , "cl.s_id=sm.id");//        $this->db->join("dealer d" , "d.dealer_id=doc.d_id");        $this->db->join("city c" , "c.city_id=pharma.city_id");        $this->db->join("state st" , "st.state_id=pharma.state_id");              if(!is_admin()){                         $where_b ='( '; //         $this->db->or_where('pharma.crm_user_id', logged_user_data());          $where_b .=" pharma.crm_user_id = ".logged_user_data();         if(!empty($boss_are)){             $where_b .= " AND ( ";             $k=0;                foreach($boss_id as $value){//          $this->db->or_where('pharma.city_id',$value);                 if($k > 0 && count($boss_id)!=$k){                   $where_b .= " OR ";               }                                $where_b  .= " pharma.crm_user_id  != $value ";                               $k++;            }                                  $where_b .='  ) ';           }         $where_b .='  ) ';             $this->db->where($where_b);                       //         $where_b ='( '; ////         $this->db->or_where('pharma.crm_user_id', logged_user_data());//          $where_b .=" pharma.crm_user_id = ".logged_user_data();//         if(!empty($boss_are)){//             $k=0;    //            foreach($boss_id as $value){////          $this->db->or_where('pharma.city_id',$value);//                $where_b  .= " OR pharma.crm_user_id  != $value ";//               //                $k++;//            }//            //           //           }//         $where_b .=' ) ';//             $this->db->where($where_b);                 if(!empty($cities_are)){             $where='( ';                 $k=0;                foreach($city_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " pharma.city_id = $value ";                 $k++;               if($k > 0 && count($city_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->where($where);        }                         if(!empty($pharma_are)){             $where='( ';                 $k=0;                foreach($pharma_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " pharma.pharma_id = '$value'";                 $k++;                               if($k > 0 && count($pharma_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->or_where($where);        }      }              if(!empty($data)){         $this->db->like('pharma.company_name',$data);         $this->db->or_like('c.city_name',$data);         $this->db->or_like('st.state_name',$data);                 }                      $query = $this->db->get();//         echo $this->db->last_query(); die;         if($this->db->affected_rows()){                        return json_encode($query->result_array());        }        else{                        return FALSE;        }    }	      public function search_pharmacy_info($data=''){         $cities_are = logged_user_cities();         $city_id=explode(',', $cities_are);         $boss_are = logged_user_boss();          $boss_id=explode(',', $boss_are);          $pharma_are = logged_user_pharmaare();          $pharma_id=explode(',', $pharma_are);//         echo $pharma_are; die;                 $arr = "pharma.pharma_id as id,pharma.d_id as dealers_id,pharma.company_name as com_name,pharma.company_email as com_email,pharma.company_phone as com_ph,c.city_name as c_city,pharma.pharmacy_status as status,pharma.blocked";        $this->db->select($arr);        $this->db->from("pharmacy_list pharma");//        $this->db->join("srm_school_master sm" , "cl.s_id=sm.id");//        $this->db->join("dealer d" , "d.dealer_id=doc.d_id");        $this->db->join("city c" , "c.city_id=pharma.city_id");        $this->db->join("state st" , "st.state_id=pharma.state_id");              if(!is_admin()){                         $where_b ='( '; //         $this->db->or_where('pharma.crm_user_id', logged_user_data());          $where_b .=" pharma.crm_user_id = ".logged_user_data(). " AND ( ";         if(!empty($boss_are)){             $k=0;                foreach($boss_id as $value){//          $this->db->or_where('pharma.city_id',$value);                 if($k > 0 && count($boss_id)!=$k){                   $where_b .= " OR ";               }                                $where_b  .= " pharma.crm_user_id  != $value ";                               $k++;            }                                  }         $where_b .=' ) ) ';          //   $this->db->where($where_b);                       //         $where_b ='( '; ////         $this->db->or_where('pharma.crm_user_id', logged_user_data());//          $where_b .=" pharma.crm_user_id = ".logged_user_data();//         if(!empty($boss_are)){//             $k=0;    //            foreach($boss_id as $value){////          $this->db->or_where('pharma.city_id',$value);//                $where_b  .= " OR pharma.crm_user_id  != $value ";//               //                $k++;//            }//            //           //           }//         $where_b .=' ) ';//             $this->db->where($where_b);                 if(!empty($cities_are)){             $where='( ';                 $k=0;                foreach($city_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " pharma.city_id = $value ";                 $k++;               if($k > 0 && count($city_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->where($where);        }                         if(!empty($pharma_are)){             $where='( ';                 $k=0;                foreach($pharma_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " pharma.pharma_id = '$value'";                 $k++;                               if($k > 0 && count($pharma_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->or_where($where);        }      }              if(!empty($data)){		$this->db->where('c.city_name like "'.$data.'" or pharma.company_name like"'.$data.'"');       /*   $this->db->like('pharma.company_name',$data);         $this->db->or_like('c.city_name',$data);         $this->db->or_like('st.state_name',$data); */                 }                      $query = $this->db->get();     //echo $this->db->last_query(); die;         if($this->db->affected_rows()){                        return json_encode($query->result_array());        }        else{                        return FALSE;        }    }    	public function search_pharmacymaster_info_doc($data=''){         $cities_are = logged_user_cities();         $city_id=explode(',', $cities_are);         $boss_are = logged_user_boss();          $boss_id=explode(',', $boss_are);          $pharma_are = logged_user_pharmaare();          $pharma_id=explode(',', $pharma_are);//         echo $pharma_are; die;                 $arr = "pharma.pharma_id as id,pharma.d_id as dealers_id,pharma.company_name as com_name,pharma.company_email as com_email,pharma.company_phone as com_ph,c.city_name as c_city,pharma.pharmacy_status as status,pharma.blocked";        $this->db->select($arr);        $this->db->from("pharmacy_list pharma");//        $this->db->join("srm_school_master sm" , "cl.s_id=sm.id");//        $this->db->join("dealer d" , "d.dealer_id=doc.d_id");        $this->db->join("city c" , "c.city_id=pharma.city_id");        $this->db->join("state st" , "st.state_id=pharma.state_id");              if(!is_admin()){                         $where_b ='( '; //         $this->db->or_where('pharma.crm_user_id', logged_user_data());          $where_b .=" pharma.crm_user_id = ".logged_user_data(). " AND ( ";         if(!empty($boss_are)){             $k=0;                foreach($boss_id as $value){//          $this->db->or_where('pharma.city_id',$value);                 if($k > 0 && count($boss_id)!=$k){                   $where_b .= " OR ";               }                                $where_b  .= " pharma.crm_user_id  != $value ";                               $k++;            }                                  }         $where_b .=' ) ) ';             $this->db->where($where_b);                       //         $where_b ='( '; ////         $this->db->or_where('pharma.crm_user_id', logged_user_data());//          $where_b .=" pharma.crm_user_id = ".logged_user_data();//         if(!empty($boss_are)){//             $k=0;    //            foreach($boss_id as $value){////          $this->db->or_where('pharma.city_id',$value);//                $where_b  .= " OR pharma.crm_user_id  != $value ";//               //                $k++;//            }//            //           //           }//         $where_b .=' ) ';//             $this->db->where($where_b);                 if(!empty($cities_are)){             $where='( ';                 $k=0;                foreach($city_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " pharma.city_id = $value ";                 $k++;               if($k > 0 && count($city_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->where($where);        }                         if(!empty($pharma_are)){             $where='( ';                 $k=0;                foreach($pharma_id as $value){//          $this->db->or_where('pharma.city_id',$value);                $where  .= " pharma.pharma_id = '$value'";                 $k++;                               if($k > 0 && count($pharma_id)!=$k){                   $where .= " OR ";               }                           }             $where .=' )';             $this->db->or_where($where);        }      }              if(!empty($data)){         $this->db->like('pharma.company_name',$data);        // $this->db->or_like('c.city_name',$data);		// $this->db->or_like('st.state_name',$data);                 }                      $query = $this->db->get();//         echo $this->db->last_query(); die;         if($this->db->affected_rows()){                        return json_encode($query->result_array());        }        else{                        return FALSE;        }    }        public function search_city_info($data=''){         $cities_are = logged_user_cities();         $city_id=explode(',', $cities_are);                $arr = "c.city_name as cityname";        $this->db->select($arr);        $this->db->from("city c");               if(!empty($data)){                  $this->db->like('c.city_name',$data);        }                 if(!empty($cities_are)){                             $k=0;                 $where=' ( ';            foreach($city_id as $value){//          $this->db->or_where('d.city_id',$value);              $where  .= " c.city_id = $value ";                 $k++;               if($k > 0 && count($city_id)!=$k){                   $where .= " OR ";               }            }            $where  .= " ) ";            $this->db->where($where);           }                                   $query = $this->db->get();//         echo $this->db->last_query(); die;                 if($this->db->affected_rows()){                        return json_encode($query->result_array());        }        else{                        return FALSE;        }            }        }